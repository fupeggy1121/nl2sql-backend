# .env 配置快速参考

## DeepSeek 配置（推荐）

```env
# Flask Configuration
FLASK_ENV=development
FLASK_APP=run.py
DEBUG=True
PORT=8000
SECRET_KEY=dev-secret-key-change-in-production

# Database Configuration
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=password
DB_NAME=report_db

# DeepSeek LLM Configuration ✨
DEEPSEEK_API_KEY=sk-your-api-key-here
DEEPSEEK_BASE_URL=https://api.deepseek.com
DEEPSEEK_MODEL=deepseek-chat

# LLM Provider Selection
LLM_PROVIDER=deepseek
```

## 获取 DeepSeek API 密钥步骤

1. 访问 https://www.deepseek.com
2. 注册或登录
3. 进入 API 管理页面
4. 点击"创建新的 API 密钥"
5. 复制密钥到 `.env` 中的 `DEEPSEEK_API_KEY`

## OpenAI 配置（备选）

```env
# Flask Configuration
FLASK_ENV=development
FLASK_APP=run.py
DEBUG=True
PORT=8000
SECRET_KEY=dev-secret-key-change-in-production

# Database Configuration
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=password
DB_NAME=report_db

# OpenAI LLM Configuration
OPENAI_API_KEY=sk-your-api-key-here
OPENAI_MODEL=gpt-3.5-turbo

# LLM Provider Selection
LLM_PROVIDER=openai
```

## 配置验证清单

- [ ] `DEEPSEEK_API_KEY` 已设置（如使用 DeepSeek）
- [ ] `OPENAI_API_KEY` 已设置（如使用 OpenAI）
- [ ] `LLM_PROVIDER` 设置为 `deepseek` 或 `openai`
- [ ] `DB_HOST`, `DB_PORT`, `DB_USER`, `DB_PASSWORD`, `DB_NAME` 已配置
- [ ] `FLASK_ENV` 设置为 `development` 或 `production`
- [ ] `SECRET_KEY` 已修改（生产环境）

## 常用命令

```bash
# 查看当前配置
cat .env

# 从示例创建配置
cp .env.example .env

# 编辑配置
nano .env  # 或使用你的编辑器

# 验证语法
python -c "from dotenv import load_dotenv; load_dotenv(); print('✓ .env 配置有效')"

# 启动应用
python run.py

# 运行测试
pytest tests/ -v

# 测试 DeepSeek 集成
curl -X POST http://localhost:8000/api/query/nl-to-sql \
  -H "Content-Type: application/json" \
  -d '{"natural_language": "查询所有用户"}'
```

## 环境变量说明

### Flask 配置
- `FLASK_ENV`: 运行环境 (development/production)
- `FLASK_APP`: Flask 应用入口
- `DEBUG`: 是否启用调试模式
- `PORT`: 应用端口
- `SECRET_KEY`: Flask 会话密钥

### 数据库配置
- `DB_HOST`: MySQL 主机地址
- `DB_PORT`: MySQL 端口
- `DB_USER`: MySQL 用户名
- `DB_PASSWORD`: MySQL 密码
- `DB_NAME`: 数据库名称

### DeepSeek 配置
- `DEEPSEEK_API_KEY`: DeepSeek API 密钥 (必需)
- `DEEPSEEK_BASE_URL`: API 端点地址
- `DEEPSEEK_MODEL`: 使用的模型名称

### OpenAI 配置 (可选)
- `OPENAI_API_KEY`: OpenAI API 密钥
- `OPENAI_MODEL`: 使用的模型名称

### LLM 选择
- `LLM_PROVIDER`: 选择 LLM 提供商 (deepseek/openai)

## 故障排查

| 问题 | 原因 | 解决方案 |
|------|------|---------|
| "API key not configured" | 缺少 API 密钥 | 设置 `DEEPSEEK_API_KEY` |
| "Connection refused" | 数据库连接失败 | 检查 `DB_HOST`, `DB_PORT` |
| "Timeout" | API 请求超时 | 检查网络连接 |
| "Invalid model" | 模型名称错误 | 确认 `DEEPSEEK_MODEL` 正确 |

## 生产环境建议

```env
# 生产环境示例
FLASK_ENV=production
DEBUG=False
SECRET_KEY=generate-a-strong-random-key
DB_HOST=your-production-db-host
DB_USER=prod_user
DB_PASSWORD=strong-password
DEEPSEEK_API_KEY=your-production-api-key
```

## 密钥生成

生成强随机密钥：
```bash
python -c "import secrets; print(secrets.token_hex(32))"
```

## 更新日志

- 2026-01-31: 添加 DeepSeek API 配置支持
- 2026-01-31: 支持多 LLM 提供商
- 2026-01-31: 完整的集成测试覆盖
